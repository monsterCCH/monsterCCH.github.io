---
layout: post
title: 日常随笔
categories: essay
description: 记录一些平时遇到的问题
keywords: 
---

## 评价一台服务器的硬件资源是否能承载10Gbps流量的dpi深度协议解析还原的能力

10 Gbps 的流量意味着每秒钟传输 10,000,000,000 个比特位。 以太网帧通常是 64-1500 字节，平均长度约为 500 字节。 如果我们假设每个数据包的平均大小为 500 bit，则一秒钟内可以传输 10,000,000,000 / 500 = 20,000,000 个数据包。也就是2千万个包 cpu核心数按照刚才栋哥说的12个核心算，每个线程每秒要处理(2000000/12)约为166.6万个数据包，即每个包最多花费1000000/1666666=0.6微秒的时间 0.6微秒能执行的指令个数是有限的，假设1GHZ cpu，即一个纳秒执行一条指令，0.6微秒可以执行600条指令，如果是2.6GHZ主频则可以执行1560条指令 也就是说按照这种估算12 个core，2.6GHZ主频1个数据包处理需要1560个指令，从而评判抓包，解码，流重组和协议还原在处理完这1个包指令数应该小于1560条， 否则要么修改程序架构减少处理一个包的指令集，要么通过在不改变程序架构的基础上提升系统硬件资源（硬件性能、处理器速度、内存带宽等）

万兆网卡是一种网络接口卡，它支持以太网标准的数据传输速率为10Gbps，是千兆网卡的10倍速率。在万兆网卡中，帧前导和帧间隙是两个重要的概念。帧前导（Preamble）是在数据帧前面附加的一段固定长度的数据，用于同步接收方的时钟。在以太网中，帧前导长度为7个字节（56位），其内容为10101010...1010（即连续的Alternating 1和0）。发送方在发送数据帧前，会先发送帧前导，接收方通过解析帧前导来获取数据帧的时钟同步信息，确保数据的正确接收和解析。帧间隙（Interframe Gap）是相邻两个数据帧之间的一段时间间隔，用于隔离不同数据帧之间的干扰。在万兆网卡中，帧间隙长度为96个比特时间，即96个时钟周期。帧间隙由物理层控制，它在发送数据帧后，会在发送方和接收方之间插入一段固定长度的空闲时间，避免不同数据帧之间的干扰。总之，帧前导和帧间隙是以太网中用于同步和隔离数据帧的两个重要概念，它们保证了数据的正确接收和解析，提高了网络的可靠性和稳定性

假设，我们要跑满10GE网卡，每个包64字节，这就需要2000万PPS（注：以太网万兆网卡速度上限是1488万PPS，因为最小帧大小为84B《Bandwidth, Packets Per Second, and Other Network Performance Metrics》），100G是2亿PPS，即每个包的处理耗时不能超过50纳秒。
